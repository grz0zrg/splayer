function getAdvancePercentage(e,t){return e/1e3*t}function getLineOpacity(e,t,n){var i=(e+1)/n.lines,o=t-i*n.direction;(o<0||o>1)&&(o+=n.direction);var a=n.trail/100,l=1-o/a;if(l<0)return n.opacity;var s=1-n.opacity;return l*s+n.opacity}function createEl(e,t){void 0===t&&(t={});var n=document.createElement(e);for(var i in t)n[i]=t[i];return n}function vendor(e,t){if(void 0!==e.style[t])return t;var n="ms"+t.charAt(0).toUpperCase()+t.slice(1);return void 0!==e.style[n]?n:""}function css(e,t){for(var n in t)e.style[vendor(e,n)||n]=t[n];return e}function getColor(e,t){return"string"==typeof e?e:e[t%e.length]}function drawLines(e,t){for(var n=0;n<t.lines;n++){var i=css(createEl("div"),{position:"absolute",top:1+~(t.scale*t.width/2)+"px",opacity:t.opacity});t.shadow&&i.appendChild(css(fill("#000","0 0 4px #000",t,n),{top:"2px"})),i.appendChild(fill(getColor(t.color,n),"0 0 1px rgba(0,0,0,.1)",t,n)),e.appendChild(i)}return e}function fill(e,t,n,i){return css(createEl("div"),{position:"absolute",width:n.scale*(n.length+n.width)+"px",height:n.scale*n.width+"px",background:e,boxShadow:t,transformOrigin:"left",transform:"rotate("+~~(360/n.lines*i+n.rotate)+"deg) translate("+n.scale*n.radius+"px,0)",borderRadius:(n.corners*n.scale*n.width>>1)+"px"})}var saveAs=saveAs||function(e){"use strict";if(!("undefined"==typeof e||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var t=e.document,n=function(){return e.URL||e.webkitURL||e},i=t.createElementNS("http://www.w3.org/1999/xhtml","a"),o="download"in i,a=function(e){var t=new MouseEvent("click");e.dispatchEvent(t)},l=/constructor/i.test(e.HTMLElement)||e.safari,s=/CriOS\/[\d]+/.test(navigator.userAgent),r=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},d="application/octet-stream",c=4e4,u=function(e){var t=function(){"string"==typeof e?n().revokeObjectURL(e):e.remove()};setTimeout(t,c)},m=function(e,t,n){t=[].concat(t);for(var i=t.length;i--;){var o=e["on"+t[i]];if("function"==typeof o)try{o.call(e,n||e)}catch(e){r(e)}}},p=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e},g=function(t,r,c){c||(t=p(t));var g,f=this,v=t.type,h=v===d,_=function(){m(f,"writestart progress write writeend".split(" "))},w=function(){if((s||h&&l)&&e.FileReader){var i=new FileReader;return i.onloadend=function(){var t=s?i.result:i.result.replace(/^data:[^;]*;/,"data:attachment/file;"),n=e.open(t,"_blank");n||(e.location.href=t),t=void 0,f.readyState=f.DONE,_()},i.readAsDataURL(t),void(f.readyState=f.INIT)}if(g||(g=n().createObjectURL(t)),h)e.location.href=g;else{var o=e.open(g,"_blank");o||(e.location.href=g)}f.readyState=f.DONE,_(),u(g)};return f.readyState=f.INIT,o?(g=n().createObjectURL(t),void setTimeout(function(){i.href=g,i.download=r,a(i),_(),u(g),f.readyState=f.DONE})):void w()},f=g.prototype,v=function(e,t,n){return new g(e,t||e.name||"download",n)};return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,n){return t=t||e.name||"download",n||(e=p(e)),navigator.msSaveOrOpenBlob(e,t)}:(f.abort=function(){},f.readyState=f.INIT=0,f.WRITING=1,f.DONE=2,f.error=f.onwritestart=f.onprogress=f.onwrite=f.onabort=f.onerror=f.onwriteend=null,v)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&module.exports?module.exports.saveAs=saveAs:"undefined"!=typeof define&&null!==define&&null!==define.amd&&define("FileSaver.js",function(){return saveAs});var __assign=this&&this.__assign||Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},defaults={lines:12,length:7,width:5,radius:10,scale:1,corners:1,color:"#000",opacity:.25,rotate:0,direction:1,speed:1,trail:100,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!1,position:"absolute"},Spinner=function(){function e(e){void 0===e&&(e={}),this.opts=__assign({},defaults,e)}return e.prototype.spin=function(e){var t=this;this.stop(),this.el=createEl("div",{className:this.opts.className}),this.el.setAttribute("role","progressbar"),css(this.el,{position:this.opts.position,width:0,zIndex:this.opts.zIndex,left:this.opts.left,top:this.opts.top}),e&&e.insertBefore(this.el,e.firstChild||null);var n,i;"undefined"!=typeof requestAnimationFrame?(n=requestAnimationFrame,i=function(){return performance.now()}):(n=function(e){return setTimeout(e,1e3/t.opts.fps)},i=function(){return Date.now()});var o,a=0,l=function(){var e=i();void 0===o&&(o=e-1),a+=getAdvancePercentage(e-o,t.opts.speed),o=e,a>1&&(a-=Math.floor(a));for(var s=0;s<t.opts.lines;s++)if(s<t.el.childNodes.length){var r=getLineOpacity(s,a,t.opts);t.el.childNodes[s].style.opacity=r.toString()}t.animateId=t.el?n(l):void 0};return drawLines(this.el,this.opts),l(),this},e.prototype.stop=function(){return this.el&&("undefined"!=typeof requestAnimationFrame?cancelAnimationFrame(this.animateId):clearTimeout(this.animateId),this.el.parentNode&&this.el.parentNode.removeChild(this.el),this.el=void 0),this},e}(),WUI_Dialog=new function(){"use strict";var e=this,t={},n=null,i=null,o=null,a=0,l=0,s=0,r=0,d=null,c=[],u={dialog:"wui-dialog",content:"wui-dialog-content",btn:"wui-dialog-btn",btn_close:"wui-dialog-close",detach:"wui-dialog-detach",minimized:"wui-dialog-minimized",minimize:"wui-dialog-minimize",maximize:"wui-dialog-maximize",header:"wui-dialog-header",open:"wui-dialog-open",closed:"wui-dialog-closed",draggable:"wui-dialog-draggable",transition:"wui-dialog-transition",dim_transition:"wui-dialog-dim-transition",modal:"wui-dialog-modal",status_bar:"wui-dialog-status-bar"},m={title:"",width:"80%",height:"40%",open:!0,closable:!0,minimizable:!1,draggable:!1,resizable:!1,detachable:!1,min_width:"title",min_height:32,header_btn:null,status_bar:!1,status_bar_content:"",keep_align_when_resized:!1,halign:"left",valign:"top",top:0,left:0,modal:!1,minimized:!1,on_close:null,on_detach:null,on_pre_detach:null,on_resize:null},p=function(e){for(var t=e.parentElement;null!=t;){if(t.classList.contains(u.dialog))return!0;t=t.parentElement}return!1};Element.prototype._addEventListener||(Element.prototype._addEventListener=Element.prototype.addEventListener,Element.prototype.addEventListener=function(e,t,n){this._addEventListener(e,t,n),p(this)&&(this.eventListenerList||(this.eventListenerList={}),this.eventListenerList[e]||(this.eventListenerList[e]=[]),this.eventListenerList[e].push(t))},Element.prototype._removeEventListener=Element.prototype.removeEventListener,Element.prototype.removeEventListener=function(e,t,n){if(this.eventListenerList){var i,o=this.eventListenerList[e];if(o)for(i=0;i<o.length;i+=1)if(o[i]===t){o.splice(i,1);break}}this._removeEventListener(e,t,n)});var g=function(e){var t=0;for(t=0;t<c.length;t+=1)if(c[t]===e.detachable_ref){c.splice(t,1);break}},f=function(e,n,i,o){var a,l,s,r,d=t[e.id];if(d&&(n&&d.detachable_ref&&(d.detachable_ref.closed||d.detachable_ref.close(),g(d)),!d.dialog.classList.contains(u.closed))){if(o&&d.modal_element)for(document.body.removeChild(d.modal_element),l=0;l<c.length;l+=1)for(r=c[l],a=r.document.body.getElementsByClassName(u.modal),s=0;s<a.length;s+=1)r.document.body.removeChild(a[s]);d.dialog.classList.contains(u.open)&&(e.classList.add(u.closed),e.classList.remove(u.open),i&&null!==d.opts.on_close&&d.opts.on_close())}},v=function(e){var n=0,i=null,o=null,a=t[e.id];if(!a.opts.modal){for(var l in t)t.hasOwnProperty(l)&&(i=t[l].dialog,isNaN(i.style.zIndex)||(n=parseInt(i.style.zIndex,10),n>100&&(i.style.zIndex=100)));for(o=a.dialog.parentElement;null!==o;)o.classList.contains(u.dialog)&&(o.style.zIndex=101),o=o.parentElement;e.style.zIndex=101}},h=function(e){var t=document.createElement("div");return t.className="wui-dialog-modal",t.addEventListener("click",function(t){t.preventDefault(),f(e,!0,!0,!0)}),t.style.zIndex=16777270,t},_=function(e){var n=t[e.id],i=n.opts,o=e.parentElement.offsetWidth,a=e.parentElement.offsetHeight,l=e.offsetWidth,s=e.offsetHeight;e.style.left="center"===i.halign?Math.round((o-l)/2+i.left)+"px":"right"===i.halign?o-l+i.left+"px":i.left+"px",e.style.top="center"===i.valign?Math.round((a-s)/2+i.top)+"px":"bottom"===i.valign?a-s+i.top+"px":i.top+"px"},w=function(e,n){var i=t[n.id],o=i.resize_handler;i.dialog!==n&&w(i.header_minimaxi_btn,i.dialog),e.classList.toggle(u.minimize),e.classList.toggle(u.maximize),n.classList.toggle(u.minimized),n.classList.contains(u.minimized)?(n.style.borderStyle="solid",n.style.borderColor="#808080",n.style.borderWidth="1px"):(n.style.borderStyle="",n.style.borderColor="",n.style.borderWidth=""),o&&o.classList.toggle(u.open),i.status_bar&&i.status_bar.classList.toggle(u.open)},y=function(e){null===d&&(d=setTimeout(function(){d=null;var n,i,o,a,l,s,r,c=document;if(e)for(c=e.document,n=c.getElementsByClassName(u.content),r=0;r<n.length;r+=1)o=n[r],a=o.parentElement,i=t[a.id],l=a.getElementsByClassName(u.status_bar),o.style.height=l.length>0?e.innerHeight-32+"px":e.innerHeight+"px",s=o.getBoundingClientRect(),i.opts.on_resize&&i.opts.on_resize(s.width,s.height);else for(n=c.getElementsByClassName(u.content),r=0;r<n.length;r+=1)o=n[r],a=o.parentElement,l=a.getElementsByClassName(u.status_bar),o.style.height=l.length>0?a.offsetHeight-64+"px":a.offsetHeight-32+"px",_(a),s=o.getBoundingClientRect(),i=t[a.id],i.opts.on_resize&&i.opts.on_resize(s.width,s.height)},125))},b=function(e,t){var n,i;do{if(1==e.nodeType&&e.eventListenerList)for(n in e.eventListenerList)if("length"!==n&&e.eventListenerList.hasOwnProperty(n))for(i=0;i<e.eventListenerList[n].length;i+=1)t.addEventListener(n,e.eventListenerList[n][i],!1);e.hasChildNodes()&&b(e.firstChild,t.firstChild),e=e.nextSibling,t=t.nextSibling}while(e&&t)},L=function(e){var n,i,o,a,l,s,r,d=t[e.id],m=e.firstElementChild.firstElementChild.firstElementChild,p=m.textContent||m.innerText||"",g=d.detachable_ref,v=e.getBoundingClientRect();for(d.opts.on_pre_detach&&d.opts.on_pre_detach(),e.classList.contains(u.minimized)?(n=parseInt(e.style.width,10),i=parseInt(e.style.height,10)-32):(n=v.width,i=v.height-32),o=void 0!==window.screenLeft?window.screenLeft:screen.left,a=void 0!==window.screenTop?window.screenTop:screen.top,f(e,!0,!1,!1),g=window.open("",p,["toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=yes","width="+n,"height="+i,"top="+(v.top+a+32),"left="+(v.left+o)].join(",")),d.detachable_ref=g,s="",l=document.head.getElementsByTagName("link"),r=0;r<l.length;r+=1)"text/css"===l[r].type&&"stylesheet"===l[r].rel&&(s+=l[r].outerHTML);for(l=document.head.getElementsByTagName("style"),r=0;r<l.length;r+=1)s+=l[r].outerHTML;g.document.open(),g.document.write("<html><head>"+("<title>"+p+"</title>")+s+"</head>"+('<body id="'+e.id+'" class="wui-dialog-detach-window-body" onload="parent.opener.WUI_Dialog.childWindowLoaded(document.body.id)">')+"</body></html>"),g.document.close(),g.document.body.appendChild(e.children[1].cloneNode(!0));var h=e.getElementsByClassName(u.status_bar);if(h.length>0){var _=h[0].cloneNode(!0);_.classList.add(u.open),g.document.body.appendChild(_)}g.addEventListener("keyup",function(t){27===t.keyCode&&f(e,!0,!0,!0)},!1),g.addEventListener("resize",function(){y(g)},!1),g.addEventListener("beforeunload",function(){f(e,!0,!0,!0)},!1),c.push(g)},E=function(e){e.preventDefault();var t=e.target,n=null;t.classList.contains(u.btn_close)?(n=t.parentElement.parentElement,f(n,!1,!0,!0)):t.classList.contains(u.maximize)||t.classList.contains(u.minimize)?(n=t.parentElement.parentElement,w(t,n)):t.classList.contains(u.detach)&&(n=t.parentElement.parentElement,L(n))},x=function(n){if(27===n.keyCode){var i,o;for(i in t)if(t.hasOwnProperty(i)&&(o=t[i],o.opts.closable&&"101"===o.dialog.style.zIndex&&o.dialog.classList.contains(u.open)))return void e.close(i,!0)}},C=function(e){if(n){e.preventDefault();var i,s,r,d=t[n.id],c=e.clientX,u=e.clientY,m=e.changedTouches,p=null;if(m)for(i=0;i<m.length;i+=1)if(p=m[i],p.identifier===o){c=m[i].clientX,u=m[i].clientY;break}s=c-a,r=u-l,n.style.left=s+"px",n.style.top=r+"px",d.dialog!==n&&(d.dialog.style.left=s+"px",d.dialog.style.top=r+"px")}},k=function(e){if(n){var t,i=e.changedTouches,a=null,l=n.ownerDocument,s=l.defaultView||l.parentWindow;if(i){for(t=0;t<i.length;t+=1)if(a=i[t],a.identifier===o){n=null,l.body.style.cursor="default",s.removeEventListener("touchmove",C,!1),s.removeEventListener("touchend",k,!1);break}}else n=null,l.body.style.cursor="default",s.removeEventListener("mousemove",C,!1),s.removeEventListener("mouseup",k,!1)}},I=function(e){var t,i,s,r=e.clientX,d=e.clientY,c=0,m=0,p=e.changedTouches;if(e.preventDefault(),null===n)if(p)o=p[0].identifier,r=p[0].clientX,d=p[0].clientY;else if(0!==e.button)return;s=e.target.parentElement,!s.classList.contains(u.maximize)&&s.classList.contains(u.draggable)&&(n=s,t=n.ownerDocument,i=t.defaultView||t.parentWindow,v(n),t.body.style.cursor="move",c=parseInt(n.style.left,10),m=parseInt(n.style.top,10),a=r-c,l=d-m,i.addEventListener("mousemove",C,!1),i.addEventListener("touchmove",C,!1),i.addEventListener("mouseup",k,!1),i.addEventListener("touchend",k,!1))},T=function(e){e.preventDefault(),e.stopPropagation();var t=e.target.parentElement,n=t.offsetLeft,a=t.offsetTop,l=e.changedTouches,d=t.ownerDocument,c=d.defaultView||d.parentWindow;l&&(o=l[0].identifier),s=n,r=a,t.classList.remove(u.dim_transition),c.addEventListener("mousemove",W,!1),c.addEventListener("touchmove",W,!1),c.addEventListener("mouseup",D,!1),c.addEventListener("touchend",D,!1),i=t},W=function(e){e.preventDefault();var n,a,l=e.clientX,d=e.clientY,c=e.changedTouches,m=null,p=t[i.id],g=null,f=null,v=0,h=0,w=0;if(c)for(h=0;h<c.length;h+=1)if(m=c[h],m.identifier===o){l=c[h].clientX,d=c[h].clientY;break}for(n=l-s,a=d-r,f=i.firstElementChild.firstElementChild.firstElementChild,v=f.offsetWidth+148,"title"===p.opts.min_width&&n<v?n=v:n<p.opts.min_width&&(n=p.opts.min_width),p.opts.status_bar&&(w=32),a<p.opts.min_height+w&&(a=p.opts.min_height+w),i.style.width=n+"px",i.classList.contains(u.minimized)||(i.style.height=a+"px"),g=i.getElementsByClassName(u.content),h=0;h<g.length;h+=1){var y,b=g[h],L=t[b.parentElement.id];b.style.height=i.offsetHeight-32-w+"px",y=b.getBoundingClientRect(),L.opts.on_resize&&L.opts.on_resize(y.width,y.height),p.opts.keep_align_when_resized&&_(i)}},D=function(e){var t=i.ownerDocument,n=t.defaultView||t.parentWindow;e.preventDefault(),i.classList.add(u.dim_transition),n.removeEventListener("mousemove",W,!1),n.removeEventListener("touchmove",W,!1),n.removeEventListener("mouseup",D,!1),n.removeEventListener("touchend",D,!1),i=null},M=function(){for(var e in t)t.hasOwnProperty(e)&&f(t[e].dialog,!0,!1,!0)},z=function(){console.log("WUI_RangeSlider 'create' failed, first argument not an id nor a DOM element.")};this.create=function(e,n){var i,o,a=document.createElement("div"),l=null,s=null,r=null,d=null,c=null,p=null,g=null,f=null,h=null,b={},L=0;if("string"==typeof e)i=document.getElementById(e);else{if("object"!=typeof e)return void z();if("string"!=typeof e.innerHTML)return void z();i=e,e=i.id}if(void 0!==t[e])return void console.log("WUI_Dialog id '"+e+"' already created, aborting.");for(o in m)m.hasOwnProperty(o)&&(b[o]=m[o]);if(void 0!==n)for(o in n)n.hasOwnProperty(o)&&void 0!==m[o]&&(b[o]=n[o]);var x=i.firstElementChild;if(null===x&&(x=document.createElement("div"),i.appendChild(x)),i.style.width=b.width,i.style.height=b.height,i.classList.add(u.dialog),x.classList.add(u.content),a.className=u.header,"auto"!==b.height&&"100%"!==b.height&&(x.style.height=b.status_bar?i.offsetHeight-64+"px":i.offsetHeight-32+"px"),p=document.createElement("div"),c=document.createElement("div"),p.style.display="inline-block",c.className="wui-dialog-title",p.innerHTML=b.title,c.appendChild(p),a.appendChild(c),b.draggable&&(i.classList.toggle(u.draggable),a.addEventListener("mousedown",I,!1),a.addEventListener("touchstart",I,!1)),b.closable&&(r=document.createElement("div"),r.className=u.btn+" "+u.btn_close,r.title="Close",a.appendChild(r)),b.minimizable&&(d=document.createElement("div"),d.className=u.btn+" "+u.minimize,b.minimized&&w(d,i),a.appendChild(d)),b.detachable&&(s=document.createElement("div"),s.className=u.btn+" "+u.detach,s.title="Detach",a.appendChild(s)),b.header_btn)for(L=0;L<b.header_btn.length;L+=1)f=b.header_btn[L],g=document.createElement("div"),void 0!==f.title&&(g.title=f.title),void 0!==f.on_click&&(g.addEventListener("touchstart",f.on_click,!1),g.addEventListener("mousedown",f.on_click,!1),void 0!==f.class_name&&(g.className=u.btn+" "+f.class_name,a.appendChild(g)));return b.status_bar&&(h=document.createElement("div"),h.classList.add(u.status_bar),h.classList.add(u.transition),h.classList.add(u.open),h.innerHTML=b.status_bar_content,i.appendChild(h)),a.addEventListener("click",E,!1),a.addEventListener("touchstart",E,!1),window.addEventListener("resize",function(){y(!1)},!1),window.addEventListener("beforeunload",M,!1),i.classList.add(u.transition),i.classList.add(u.dim_transition),i.insertBefore(a,x),b.resizable&&(l=document.createElement("div"),l.addEventListener("mousedown",T,!1),l.addEventListener("touchstart",T,!1),l.classList.add("wui-dialog-resize"),l.classList.add(u.transition),l.classList.add(u.open),i.appendChild(l)),t[e]={dialog:i,minimized_id:-1,resize_handler:l,header_minimaxi_btn:d,opts:b,detachable_ref:null,modal_element:null,status_bar:h},_(i),v(i),b.open?this.open(e,!1):i.classList.add(u.closed),e},this.setStatusBarContent=function(e,n){var i,o,a=t[e];return void 0===a?void("undefined"!=typeof console&&console.log('Cannot setStatusBarContent of WUI dialog "'+e+'".')):void(a.status_bar&&(a.status_bar.innerHTML=n,o=a.detachable_ref,o&&(o.closed||(i=o.document.body.getElementsByClassName(u.status_bar),i.length>0&&(i[0].innerHTML=n)))))},this.open=function(e,n){var i,o,a,l=t[e];if(void 0===l)return void("undefined"!=typeof console&&console.log('Cannot open WUI dialog "'+e+'".'));if(l.detachable_ref&&!l.detachable_ref.closed)return void l.detachable_ref.focus();if(a=l.dialog,l.opts.modal)for(i=h(a),l.dialog.style.zIndex=16777271,l.modal_element=i,document.body.appendChild(i),o=0;o<c.length;o+=1)i=h(a),c[o].document.body.appendChild(i);return n?void L(a):(a.classList.remove(u.closed),a.classList.add(u.open),void v(a))},this.focus=function(e){var n=t[e];return void 0===n?void("undefined"!=typeof console&&console.log('Cannot focus WUI dialog "'+e+'".')):void v(n.dialog)},this.close=function(e,n){var i=t[e];return void 0===i?void("undefined"!=typeof console&&console.log('Cannot close WUI dialog "'+e+'".')):void f(i.dialog,!0,n,!0)},this.destroy=function(e){var n,i=t[e];return void 0===i?void console.log("Element id '"+e+"' is not a WUI_Dialog, destroying aborted."):(f(i.dialog,!0,!1,!0),n=i.dialog,n.parentElement.removeChild(n),void delete t[e])},this.childWindowLoaded=function(e){var n=t[e],i=n.detachable_ref;i&&(i.document.body.firstElementChild?(b(n.dialog.children[1],i.document.body.firstElementChild),n.opts.on_detach&&n.opts.on_detach(i)):window.setTimeout(function(){WUI_Dialog.childWindowLoaded(e)},500))},this.getDetachedDialog=function(e){var n=t[e],i=0;if(void 0===n)return void 0!==e&&console.log("WUI_Dialog.getDetachedDialog: Element id '"+e+"' is not a WUI_Dialog."),null;for(i=0;i<c.length;i+=1)if(c[i]===n.detachable_ref)return n.detachable_ref;return null},document.addEventListener("keyup",x,!1)},WUI_DropDown=new function(){"use strict";var e={},t={dropdown:"wui-dropdown",item:"wui-dropdown-item",content:"wui-dropdown-content",selected:"wui-dropdown-selected",open:"wui-dropdown-open",on:"wui-dropdown-on"},n={width:"auto",height:24,ms_before_hiding:2e3,vertical:!1,vspacing:0,selected_id:0,on_item_selected:null},i=function(e){var t=e.ownerDocument,n=e.getBoundingClientRect(),i=t.body,o=t.documentElement,a=t.defaultView||t.parentWindow,l=a.pageYOffset||o.scrollTop||i.scrollTop,s=a.pageXOffset||o.scrollLeft||i.scrollLeft,r=o.clientTop||i.clientTop||0,d=o.clientLeft||i.clientLeft||0,c=n.top+l-r,u=n.left+s-d;return{top:Math.round(c),left:Math.round(u)}},o=function(e,n){var i,o=e.createElement("div"),a=null,l="";for(i=0;i<n.content_array.length;i+=1)l=n.content_array[i],a=e.createElement("div"),n.opts.vertical||a.classList.add("wui-dropdown-horizontal"),a.classList.add(t.item),a.innerHTML=l,a.dataset.index=i,o.appendChild(a),a.addEventListener("click",s,!1),l===n.content_array[n.selected_id]&&a.classList.add(t.selected);o.addEventListener("mouseover",r,!1),o.classList.add(t.content),o.dataset.linkedto=n.element.id,e.body.appendChild(o),n.floating_content=o},a=function(e,n,i){n.classList.remove(t.on),i.floating_content&&i.floating_content.parentElement===e.body&&e.body.removeChild(i.floating_content),i.floating_content=null,i.close_timeout=null},l=function(n){n.preventDefault(),n.stopPropagation();var i=n.target,o=null,l=null;i.classList.contains(t.dropdown)&&(o=e[i.id],l=o.floating_content,l?l.classList.contains(t.open)&&a(n.target.ownerDocument,i,o):r(n))},s=function(n){n.preventDefault(),n.stopPropagation();var i,o,l=n.target,s=null,r=null;if(l.classList.contains(t.item)){for(s=l.parentElement,i=e[s.dataset.linkedto],r=s.getElementsByTagName("div"),o=0;o<r.length;o+=1)r[o].classList.remove(t.selected);l.classList.add(t.selected),i.selected_id=parseInt(l.dataset.index,10),i.target_element.lastElementChild.innerHTML=l.textContent,i.element!==i.target_element&&(i.element.lastElementChild.innerHTML=l.textContent),void 0!==i.opts.on_item_selected&&i.opts.on_item_selected(l.dataset.index),a(l.ownerDocument,i.target_element,i)}},r=function(n){n.preventDefault(),n.stopPropagation();var a=n.target,l=null,s=null,r=null,c=a.ownerDocument,u=c.defaultView||c.parentWindow;if(a.classList.contains(t.dropdown))l=e[a.id],null===l.floating_content&&(a.classList.add(t.on),o(c,l),r=l.floating_content,s=i(a),r.style.top=s.top-r.offsetHeight-l.opts.vspacing+"px",r.style.left=s.left+"px",r.classList.add(t.open),l.target_element=a);else if(a.classList.contains(t.content))l=e[a.dataset.linkedto];else{if(!a.classList.contains(t.item))return;l=e[a.parentElement.dataset.linkedto]}u.clearTimeout(l.close_timeout),a.addEventListener("mouseleave",d,!1)},d=function(n){n.preventDefault();var i=n.target,o=null,l=i.ownerDocument,s=l.defaultView||l.parentWindow;o=i.classList.contains(t.content)?e[i.dataset.linkedto]:i.classList.contains(t.item)?e[i.parentElement.dataset.linkedto]:e[i.id],o.close_timeout=s.setTimeout(a,o.opts.ms_before_hiding,l,o.target_element,o),i.removeEventListener("mouseleave",d,!1)},c=function(){console.log("WUI_RangeSlider 'create' failed, first argument not an id nor a DOM element.")};this.create=function(i,o,a){var s,d,u={};if("string"==typeof i)s=document.getElementById(i);else{if("object"!=typeof i)return void c();if("string"!=typeof i.innerHTML)return void c();s=i,i=s.id}if(void 0!==e[i])return void console.log("WUI_DropDown id '"+i+"' already created, aborting.");for(d in n)n.hasOwnProperty(d)&&(u[d]=n[d]);if(void 0!==o)for(d in o)o.hasOwnProperty(d)&&void 0!==n[d]&&(u[d]=o[d]);s.classList.add(t.dropdown),s.style.width=u.width,s.style.height=u.height;var m=document.createElement("div");m.classList.add("wui-dropdown-icon"),s.appendChild(m);var p=document.createElement("div");p.classList.add("wui-dropdown-text"),0!==a.length&&(p.innerHTML=a[u.selected_id]),s.appendChild(p),s.addEventListener("click",l,!1),s.addEventListener("mouseover",r,!1);var g={element:s,floating_content:null,selected_id:u.selected_id,content_array:a,opts:u,button_item:p,hover_count:0,target_element:null,close_timeout:null};return e[i]=g,i},this.destroy=function(t){var n,i=e[t];return void 0===i?void console.log("Element id '"+t+"' is not a WUI_DropDown, destroying aborted."):(n=i.element,a(document,n,i),n.parentElement.removeChild(n),void delete e[t])}},WUI_RangeSlider=new function(){"use strict";var e={},t=null,n=null,i=null,o=null,a="_wui_container",l="background-color: #00ff00",s=null,r={},d={midi_learn_btn:"MIDI learn"},c={hook:"wui-rangeslider-hook",bar:"wui-rangeslider-bar",filler:"wui-rangeslider-filler",hook_focus:"wui-rangeslider-hook-focus",value_input:"wui-rangeslider-input",midi_learn_btn:"wui-rangeslider-midi-learn-btn"},u={width:148,height:8,title:"",title_min_width:0,value_min_width:0,min:0,max:1,decimals:4,step:.01,scroll_step:.01,vertical:!1,title_on_top:!1,on_change:null,default_value:0,value:0,bar:!0,midi:null,configurable:null},m={min:0,max:0,step:0,scroll_step:0},p={opts:{},endless:!1,midi:{},value:0},g=function(e){for(var t,n,i=document.getElementById(e);i;){if(i.classList&&i.classList.contains("wui-dialog")){t=i.id;break}i=i.parentNode}return WUI_Dialog&&(n=WUI_Dialog.getDetachedDialog(t))?n.document.getElementById(e):null},f=function(e){var t=e.ownerDocument,n=e.getBoundingClientRect(),i=t.body,o=t.documentElement,a=t.defaultView||t.parentWindow,l=a.pageYOffset||o.scrollTop||i.scrollTop,s=a.pageXOffset||o.scrollLeft||i.scrollLeft,r=o.clientTop||i.clientTop||0,d=o.clientLeft||i.clientLeft||0,c=n.top+l-r,u=n.left+s-d;return{top:Math.round(c),left:Math.round(u)}},v=function(e,t){null!==e&&e(t)},h=function(e,t){var n=(+e).toFixed(t+1);return+n.slice(0,n.length-1)},_=function(e){return e.classList.contains(c.hook)?e:e.classList.contains(c.filler)?e.firstElementChild:e.firstElementChild?e.firstElementChild.firstElementChild:null},w=function(t,n,i){var o,a,l,s,r=t,d=e[r.id],u=n.opts.width,m=n.opts.height,p=Math.abs((i-n.opts.min)/n.opts.range);o=r.getElementsByClassName(c.bar)[0],a=o.firstElementChild,l=a.firstElementChild,s=o.nextElementSibling,i=h(i,d.opts.decimals),n.opts.vertical?(p=Math.round(p*o.offsetHeight),a.style.position="absolute",a.style.bottom="0",a.style.width="100%",a.style.height=p+"px",l.style.marginTop=-u+"px",l.style.marginLeft=-u/2-1+"px",l.style.width=2*u+"px",l.style.height=2*u+"px",s.style.marginTop="13px",d.element!==r&&(d.filler.style.position="absolute",d.filler.style.bottom="0",d.filler.style.width="100%",d.filler.style.height=p+"px",d.hook.style.marginTop=-u+"px",d.hook.style.marginLeft=-u/2-1+"px",d.hook.style.width=2*u+"px",d.hook.style.height=2*u+"px",d.value_input.style.marginTop="13px")):(p=Math.round(p*u),a.style.width=p+"px",a.style.height="100%",l.style.left=p+"px",l.style.marginTop=-m/2+"px",l.style.marginLeft=-m+"px",l.style.width=2*m+"px",l.style.height=2*m+"px",d.element!==r&&(d.filler.style.width=p+"px",d.filler.style.height="100%",d.hook.style.left=p+"px",d.hook.style.marginTop=-m/2+"px",d.hook.style.marginLeft=-m+"px",d.hook.style.width=2*m+"px",d.hook.style.height=2*m+"px")),d.value_input.value=i,s.value=i,n.value=i},y=function(e){if(e.preventDefault(),null!==i){var a,l,s=i.parentElement,r=s.parentElement,d=r.nextElementSibling,c=f(r),u=r.offsetWidth,m=0,p=e.clientX,g=e.clientY,_=e.changedTouches,w=null;if(_)for(a=0;a<_.length;a+=1)if(w=_[a],w.identifier===o){p=_[a].clientX,g=_[a].clientY;break}if(n.opts.vertical?(u=r.offsetHeight,m=Math.round((c.top+r.offsetHeight-g)/n.opts.step)*n.opts.step):m=Math.round((p-c.left)/n.opts.step)*n.opts.step,m>u?(m=u,t=n.opts.max):m<0?(m=0,t=n.opts.min):t=Math.round((n.opts.min+m/u*n.opts.range)/n.opts.step)*n.opts.step,n.value===t)return;n.value=t,l=h(t,n.opts.decimals),d.value=l,n.value_input.value=l,n.opts.vertical?(s.style.height=m+"px",n.filler.style.height=m+"px"):(s.style.width=m+"px",n.filler.style.width=m+"px",i.style.left=m+"px",n.hook.style.left=m+"px"),v(n.opts.on_change,t)}},b=function(e){if(i){e.preventDefault();var t,a=e.changedTouches,l=null,s=!1,r=i.ownerDocument,d=r.defaultView||r.parentWindow;if(a){for(t=0;t<a.length;t+=1)if(l=a[t],l.identifier===o){s=!0,d.removeEventListener("touchend",b,!1),d.removeEventListener("touchmove",y,!1);break}}else s=!0,d.removeEventListener("mouseup",b,!1),d.removeEventListener("mousemove",y,!1);s&&(i.classList.remove(c.hook_focus),i=null,n=null,r.body.style.cursor="default")}},L=function(t){t.stopPropagation();var a,l,s=null,r=!1,d=t.changedTouches;null===n&&d&&(o=d[0].identifier,r=!0),0===t.button&&(r=!0),r&&(i=_(t.target),i.classList.add(c.hook_focus),s=i.parentElement.parentElement.parentElement,n=e[s.id],a=s.ownerDocument,l=a.defaultView||a.parentWindow,a.body.style.cursor="pointer",y(t),l.addEventListener("mousemove",y,!1),l.addEventListener("touchmove",y,!1),l.addEventListener("mouseup",b,!1),l.addEventListener("touchend",b,!1))},E=function(t){t.preventDefault(),t.stopPropagation();var n=t.target,i=n.parentElement.parentElement.parentElement,o=e[i.id],a=o.opts.default_value;w(i,o,a),v(o.opts.on_change,a)},x=function(t){t.preventDefault(),t.stopPropagation();var n,i,o,a,l=t.wheelDelta?t.wheelDelta/40:t.detail?-t.detail:0;t.deltaY&&(l=-t.deltaY),n=_(t.target),null===n?(i=t.target.parentElement,o=e[i.id]):(i=n.parentElement.parentElement.parentElement,o=e[i.id]),a=parseFloat(o.value),l>=0?a+=o.opts.scroll_step:a-=o.opts.scroll_step,o.endless||(o.opts.max&&a>o.opts.max?a=o.opts.max:a<o.opts.min&&(a=o.opts.min)),w(i,o,a),v(o.opts.on_change,a)},C=function(t){if(!t.target.validity||t.target.validity.valid){var n=t.target.parentElement,i=e[n.id];w(n,i,t.target.value),v(i.opts.on_change,t.target.value)}},k=function(e,t,n){return function(e){var i=e.target,o=t.opts;return i.validity&&!i.validity.valid?void("min"===n||"max"===n?t.endless=!0:"step"===n&&(t.value_input.step="any")):("min"===n?(o.min=h(i.value,o.decimals),t.value_input.min=o.min,o.range=o.max-o.min,t.endless=!1):"max"===n?(o.max=h(i.value,o.decimals),t.value_input.max=o.max,o.range=o.max-o.min,t.endless=!1):"step"===n?(o.step=h(i.value,o.decimals),t.value_input.step=o.step):"scroll_step"===n&&(o.scroll_step=h(i.value,o.decimals)),void(void 0!==o.configurable[n]&&(o.configurable[n].val=i.value)))}},I=function(e){var t,n,i,o,a;if(e)for(t in r)for(n in r[t])for(i=r[t][n],a=0;a<i.widgets.length;a+=1)if(o=i.widgets[a],o===e)return void i.widgets.splice(a,1)},T=function(t){t.preventDefault(),t.stopPropagation();var n,i,o,a,r=t.target,u=r.parentElement,m=e[u.id];if(m.learn)return m.learn=!1,r.style="",r.title=d.midi_learn_btn,m.learn_elem.title=d.midi_learn_btn,s=null,m.midi.device=null,m.midi.controller=null,void I(u.id);for(i in e)e.hasOwnProperty(i)&&(o=e[i],o.learn=!1,n=g(i),n&&(a=n.getElementsByClassName(c.midi_learn_btn),a.length>0&&(a[0].style="")),o.learn_elem&&(o.learn_elem.style=""));m.learn=!0,r.style=l,s=u.id},W=function(t){t.preventDefault(),t.stopPropagation();var n,i,o,l,s,r,d,u,p=t.target,g=p.parentElement,v=e[g.id],h=v.opts,_=p.ownerDocument,w=v.element.id+a,y=1;if(document.getElementById(w)||(v.configure_panel_open=!1),v.configure_panel_open!==!0){s=_.createElement("div"),s.className="wui-rangeslider-configure-container",u=_.createElement("div"),u.className="wui-rangeslider-configure-close",n=function(e){v.configure_panel_open=!1;var t=document.getElementById(w),n=e.target.ownerDocument.getElementById(w);t&&t.parentElement&&t.parentElement.removeChild(t),n&&n.parentElement&&n.parentElement.removeChild(n)},u.addEventListener("click",n,!1),u.addEventListener("touchstart",n,!1),s.id=w,s.appendChild(u);for(o in h.configurable)h.configurable.hasOwnProperty(o)&&void 0!==m[o]&&(l=h.configurable[o],r=_.createElement("div"),r.style.display="inline-block",r.style.marginRight="8px",r.style.width="80px",r.style.textAlign="right",r.innerHTML=o.replace("_"," ")+" : ",d=_.createElement("input"),d.className=c.value_input,s.appendChild(r),s.appendChild(d),y%2===0&&s.appendChild(_.createElement("div")),d.setAttribute("type","number"),d.setAttribute("step","any"),void 0!==l&&(void 0!==l.min&&(d.setAttribute("min",l.min),d.title=d.title+" min: "+l.min),void 0!==l.max&&(d.setAttribute("max",l.max),d.title=d.title+" max: "+l.max),void 0!==l.val?d.setAttribute("value",l.val):"min"===o?d.setAttribute("value",h.min):"max"===o?d.setAttribute("value",h.max):"step"===o?d.setAttribute("value",h.step):"scroll_step"===o&&d.setAttribute("value",h.scroll_step)),d.addEventListener("input",k(t,v,o),!1),y+=1);i=f(p),g.insertBefore(s,p),v.configure_panel_open=!0;
}},D=function(){console.log("WUI_RangeSlider 'create' failed, first argument not an id nor a DOM element.")};this.create=function(t,n){var i,o,a,l={};if("string"==typeof t)i=document.getElementById(t);else{if("object"!=typeof t)return void D();if("string"!=typeof t.innerHTML)return void D();i=t,t=i.id}if(void 0!==e[t])return void console.log("WUI_RangeSlider id '"+t+"' already created, aborting.");for(a in u)u.hasOwnProperty(a)&&(l[a]=u[a]);if(void 0!==n){for(a in n)n.hasOwnProperty(a)&&void 0!==u[a]&&(l[a]=n[a]);void 0!==n.max&&(l.range=n.max),void 0!==n.step&&(l.step=n.step,void 0===n.scroll_step&&(l.scroll_step=l.step)),void 0!==n.title_on_top?l.title_on_top=n.title_on_top:l.vertical&&(l.title_on_top=!0),void 0!==n.default_value?l.default_value=n.default_value:void 0!==n.min&&void 0!==n.max&&(l.default_value=l.min+l.max/2)}l.min<0&&(l.range=l.max-l.min),e[t]=null,i.classList.add("wui-rangeslider"),l.title_on_top&&i.classList.add("wui-rangeslider-title-ontop");var s=document.createElement("div"),r=document.createElement("div"),p=document.createElement("div"),g=document.createElement("div"),f=document.createElement("div"),h=document.createElement("input"),_={element:i,opts:l,bar:null,filler:null,hook:null,endless:!1,midi:{device:null,controller:null,ctrl_type:"abs"},learn:!1,learn_elem:null,value_input:h,default_value:l.default_value,value:l.value};if(s.innerHTML=l.title,h.setAttribute("value",l.value),h.setAttribute("type","number"),h.setAttribute("step",l.step),h.classList.add(c.value_input),f.classList.add("wui-rangeslider-value"),s.classList.add("wui-rangeslider-title"),r.classList.add(c.bar),p.classList.add(c.filler),g.classList.add(c.hook),l.vertical&&(s.style.textAlign="center"),s.style.minWidth=l.title_min_width+"px",f.style.minWidth=l.value_min_width+"px",h.style.minWidth=l.value_min_width+"px",r.style.width=l.width+"px",r.style.height=l.height+"px",i.appendChild(s),l.bar||(r.style.display="none",h.style.marginTop="6px"),n.hasOwnProperty("min")?h.setAttribute("min",l.min):l.min=void 0,n.hasOwnProperty("max")?h.setAttribute("max",l.max):(l.max=void 0,void 0===l.min&&(_.endless=!0)),r.appendChild(p),p.appendChild(g),i.appendChild(r),_.bar=r,_.filler=p,_.hook=g,i.appendChild(h),l.configurable){var y=0;for(a in l.configurable)l.configurable.hasOwnProperty(a)&&void 0!==m[a]&&(y+=1);if(y>0){var b=document.createElement("div");b.classList.add("wui-rangeslider-configurable-btn"),b.addEventListener("click",W,!1),b.addEventListener("touchstart",W,!1),l.title_on_top&&!l.vertical?(b.style.bottom="0",s.style.marginBottom="4px"):l.title_on_top&&l.vertical?(s.style.marginLeft="16px",s.style.marginRight="16px",b.style.top="0"):(s.style.marginLeft="16px",b.style.top="0"),l.vertical?i.appendChild(b):i.insertBefore(b,s)}}if(l.midi)if(navigator.requestMIDIAccess){var k=document.createElement("div");k.classList.add(c.midi_learn_btn),k.title=d.midi_learn_btn,k.addEventListener("click",T,!1),k.addEventListener("touchstart",T,!1),_.learn_elem=k,l.midi.type&&(_.midi.ctrl_type=l.midi.type),i.appendChild(k)}else console.log("WUI_RangeSlider id '"+t+"' : Web MIDI API is disabled. (not supported by your browser?)");return o="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",l.bar?(r.addEventListener("mousedown",L,!1),r.addEventListener("touchstart",L,!1),r.addEventListener(o,x,!1),g.addEventListener("dblclick",E,!1)):h.addEventListener(o,x,!1),h.addEventListener("input",C,!1),e[t]=_,w(i,_,l.value),v(_.opts.on_change,_.value),t},this.destroy=function(t){var n,i,o,l=e[t];return void 0===l?void console.log("Element id '"+t+"' is not a WUI_RangeSlider, destroying aborted."):(s===t&&(midi_learn_current=null),I(t),n=l.element,n.parentElement.removeChild(n),i=n.ownerDocument,o=i.getElementById(t+a),o&&i.removeChild(o),void delete e[t])},this.getParameters=function(t){var n,i=e[t],o={};if(void 0===i)return console.log("Element id '"+t+"' is not a WUI_RangeSlider, getParameters aborted."),null;for(n in i)i.hasOwnProperty(n)&&void 0!==p[n]&&(o[n]=i[n]);return o},this.setParameters=function(t,n,i){var o,a=e[t];if(void 0===a)return void console.log("Element id '"+t+"' is not a WUI_RangeSlider, setParameters aborted.");if(n){for(o in a)a.hasOwnProperty(o)&&void 0!==n[o]&&(a[o]=n[o]);a.midi.device&&a.midi.controller&&r["d"+a.midi.device]["c"+a.midi.controller].widgets.push(t),w(a.element,a,a.value),i&&v(a.opts.on_change,a.value)}},this.setValue=function(t,n,i){var o=e[t];return void 0===o?void console.log("Element id '"+t+"' is not a WUI_RangeSlider, setParameters aborted."):(w(o.element,o,n),void(i&&v(o.opts.on_change,n)))},this.submitMIDIMessage=function(t){var n,i,o,a,l,d,u=s,m=t.data[0],p=t.data[1],f=parseInt(t.data[2],10),h="d"+m,_="c"+p,y=0;if(s)return n=e[u],r[h]||(r[h]={}),r[h][_]||(r[h][_]={prev_value:f,widgets:[],increments:1}),r[h][_].widgets.push(u),l=g(u),l&&(o=l.getElementsByClassName(c.midi_learn_btn),o.length>0&&(o[0].style="",o[0].title=h+" "+_)),n.midi.device=m,n.midi.controller=p,n.learn=!1,n.learn_elem.style="",n.learn_elem.title=h+" "+_,void(s=null);if(r[h]&&r[h][_])for(i=r[h][_],y=0;y<i.widgets.length;y+=1)if(u=i.widgets[y],n=e[u],l=g(u),a=l?l:n.element,"abs"===n.midi.ctrl_type)d=n.opts.min+n.opts.range*(f/127),w(a,n,d),v(n.opts.on_change,d);else if("rel"===n.midi.ctrl_type){var b=n.opts.step;if("any"===b&&(b=.5),i.prev_value>f){if(i.increments=-b,d=n.value-b,d<n.opts.min&&!n.endless)continue;i.prev_value=f}else if(i.prev_value<f){if(i.increments=b,d=n.value+b,d>n.opts.max&&!n.endless)continue;i.prev_value=f}else if(d=n.value+i.increments,!n.endless){if(d>n.opts.max)continue;if(d<n.opts.min)continue}w(a,n,d),v(n.opts.on_change,d)}}},WUI_Input=WUI_RangeSlider,WUI_Tabs=new function(){"use strict";var e={},t={enabled:"wui-tab-enabled",disabled:"wui-tab-disabled",display_none:"wui-tab-display-none",tabs:"wui-tabs",tab:"wui-tab",tabs_content:"wui-tabs-content",tab_content:"wui-tab-content",underline:"wui-tabs-underline"},n={on_tab_click:null,height:"calc(100% - 30px)"},i=function(n){n.preventDefault(),n.stopPropagation();var i=n.target,o=i.parentElement,a=o.nextElementSibling.nextElementSibling,l=o.parentElement.id,s=e[l],r=0,d=null,c=0;for(c=0;c<o.childElementCount;c+=1)d=o.children[c],d.classList.remove(t.enabled),d.classList.add(t.disabled),s.tabs[c].classList.remove(t.enabled),s.tabs[c].classList.add(t.disabled),d===i&&(r=c);for(c=0;c<a.childElementCount;c+=1)d=a.children[c],d.classList.remove(t.display_none),s.contents[c].classList.remove(t.display_none),r!==c&&(d.classList.add(t.display_none),s.contents[c].classList.add(t.display_none));s.tabs[r].classList.remove(t.disabled),s.tabs[r].classList.add(t.enabled),n.target.classList.remove(t.disabled),n.target.classList.add(t.enabled),s.opts.on_tab_click&&s.opts.on_tab_click(r)},o=function(){console.log("WUI_RangeSlider 'create' failed, first argument not an id nor a DOM element.")};this.create=function(a,l){var s,r,d,c,u,m=document.createElement("div"),p={},g=0;if("string"==typeof a)s=document.getElementById(a);else{if("object"!=typeof a)return void o();if("string"!=typeof a.innerHTML)return void o();s=a,a=s.id}if(r=s.firstElementChild,d=r.nextElementSibling,c=r.children[0],void 0!==e[a])return void console.log("WUI_Tabs id '"+a+"' already created, aborting.");for(u in n)n.hasOwnProperty(u)&&(p[u]=n[u]);if(void 0!==l)for(u in l)l.hasOwnProperty(u)&&void 0!==n[u]&&(p[u]=l[u]);s.style.overflow="hidden",m.className="wui-tabs-underline",s.insertBefore(m,d),r.classList.add(t.tabs);var f=r.childElementCount,v=[];for(g=0;g<f;g+=1){var h=r.children[g];h.classList.add("wui-tab"),h!==c&&h.classList.add(t.disabled),h.addEventListener("click",i,!1),h.addEventListener("touchstart",i,!1),v.push(h)}c.classList.add(t.enabled),c.classList.add("wui-first-tab"),d.classList.add("wui-tabs-content");var _=d.childElementCount,w=[d.children[0]];for(d.style.height=p.height,d.children[0].classList.add(t.tab_content),g=1;g<_;g+=1){var y=d.children[g];y.classList.add(t.tab_content),y.classList.add(t.display_none),w.push(y)}return e[a]={element:s,tabs:v,contents:w,opts:p},a},this.getContentElement=function(e,t){var n=document.getElementById(e),i=n.firstElementChild.nextElementSibling.nextElementSibling;return i.children[t]},this.getTabName=function(e,t){var n=this.getContentElement(e,t);return n.getAttribute("data-group-name")},this.destroy=function(n){var i,o,a,l,s,r=e[n];if(void 0===r)return void console.log("Element id '"+n+"' is not a WUI_Tabs, destroying aborted.");if(i=r.element,i.classList.contains("wui-dialog-content"))for(o=i.getElementsByClassName(t.tabs),a=i.getElementsByClassName(t.underline),l=i.getElementsByClassName(t.tabs_content),s=0;s<o.length;s+=1)i.removeChild(o[s]),i.removeChild(a[s]),i.removeChild(l[s]);else i.parentElement.removeChild(i);delete e[n]}},WUI_ToolBar=new function(){"use strict";var e={},t={minimize_icon:"wui-toolbar-minimize-icon",maximize_icon:"wui-toolbar-maximize-icon",button:"wui-toolbar-button",minimize_group:"wui-toolbar-minimize-group",minimize_gr_v:"wui-toolbar-minimize-group-vertical",toggle:"wui-toolbar-toggle",toggle_on:"wui-toolbar-toggle-on",item:"wui-toolbar-item",group:"wui-toolbar-group",vertical_group:"wui-toolbar-group-vertical",tb:"wui-toolbar",dd_content:"wui-toolbar-dropdown-content",dd_item:"wui-toolbar-dropdown-item",dd_open:"wui-toolbar-dropdown-open"},n={item_hmargin:null,item_vmargin:null,item_width:32,item_height:32,icon_width:32,icon_height:32,allow_groups_minimize:!1,vertical:!1},i=function(t){var n=e[t];return void 0===n?("undefined"!=typeof console&&console.log('_getWidget failed, the element id "'+t+'" is not a WUI_ToolBar.'),null):n},o=function(e){var t=e.ownerDocument,n=e.getBoundingClientRect(),i=t.body,o=t.documentElement,a=t.defaultView||t.parentWindow,l=a.pageYOffset||o.scrollTop||i.scrollTop,s=a.pageXOffset||o.scrollLeft||i.scrollLeft,r=o.clientTop||i.clientTop||0,d=o.clientLeft||i.clientLeft||0,c=n.top+l-r,u=n.left+s-d;return{top:Math.round(c),left:Math.round(u)}},a=function(n,i){return void 0!==i?e[i]:n.classList.contains(t.tb)?e[n.id]:n.classList.contains(t.minimize_icon)||n.classList.contains(t.maximize_icon)||n.classList.contains(t.vertical_group)||n.classList.contains(t.group)?e[n.parentElement.id]:e[n.parentElement.parentElement.id]},l=function(e,t,n){if(void 0!==e.on_click&&null!==e.on_click){var i={id:e.id,type:t};void 0!==n&&(i.state=n),e.on_click(i)}},s=function(e,n,i){var o,a=e.createElement("div");if(void 0!==n.items)for(o=0;o<n.items.length;o+=1){var l=n.items[o],s=e.createElement("div");n.vertical||s.classList.add("wui-toolbar-dropdown-horizontal"),s.classList.add(t.dd_item),s.innerHTML=l.title,s.dataset.index=o,a.appendChild(s)}return a.addEventListener("click",d,!1),a.style.width=i.dd_items_width+"px",a.classList.add(t.dd_content),a.dataset.linkedto_tb=i.element.id,a.dataset.linkedto_tool_index=n.id,e.body.appendChild(a),a},r=function(e,n,i){var o,s,r,d=null,c=!1,u=0;d=a(e,n),s=d.element,e.parentElement&&e.parentElement.parentElement&&(s=e.parentElement.parentElement);var m=d.tools[parseInt(e.dataset.tool_id,10)];if("1"===m.element.dataset.on?(m.element.dataset.on=0,e.dataset.on=0,m.element.title=m.tooltip,e.title=m.tooltip,void 0!==m.icon&&(m.element.classList.add(m.icon),m.element.classList.remove(m.toggled_icon),e.classList.add(m.icon),e.classList.remove(m.toggled_icon))):(m.element.dataset.on=1,e.dataset.on=1,void 0!==m.tooltip_toggled&&(m.element.title=m.tooltip_toggled,e.title=m.tooltip_toggled),void 0!==m.toggled_icon&&(m.element.classList.add(m.toggled_icon),m.element.classList.remove(m.icon),e.classList.add(m.toggled_icon),e.classList.remove(m.icon)),c=!0),"none"!==m.toggled_style&&(e.classList.contains(t.toggle_on)?(m.element.classList.remove(t.toggle_on),e.classList.remove(t.toggle_on)):(m.element.classList.add(t.toggle_on),e.classList.add(t.toggle_on))),o=e.dataset.toggle_group,void 0!==o)for(r=s.getElementsByClassName(t.item),u=0;u<r.length;u+=1){var p=r[u],g=d.tools[parseInt(p.dataset.tool_id,10)];if(o===p.dataset.toggle_group&&p.dataset.tool_id!==e.dataset.tool_id){if("0"===p.dataset.on)continue;p.dataset.on="0",g.element.dataset.on="0",p.classList.remove(t.toggle_on),g.element.classList.remove(t.toggle_on),void 0!==m.toggled_icon&&(p.classList.remove(g.toggled_icon),g.element.classList.remove(g.toggled_icon)),void 0!==m.icon&&(p.classList.add(g.icon),g.element.classList.add(g.icon)),(i||void 0===i)&&l(g,"toggle",!1)}}i!==!0&&void 0!==i||l(m,"toggle",c)},d=function(n){n.preventDefault(),n.stopPropagation();var i=n.target,o=i.ownerDocument,a=i.parentElement,l=e[a.dataset.linkedto_tb],s=parseInt(a.dataset.linkedto_tool_index,10),r=l.tools[s],d=parseInt(i.dataset.index,10),u=r.items[d],m=o.getElementById(a.dataset.linkedto_tb),p=m.getElementsByClassName(t.item),g=p[s];void 0!==u.on_click&&(u.on_click(),g.classList.remove(t.toggle_on),r.element.classList.remove(t.toggle_on),c(r,g))},c=function(e,n){var i,o,a=n.ownerDocument,l=a.body.getElementsByClassName(t.dd_content);for(o=0;o<l.length;o+=1)i=l[o],i.removeEventListener("click",d,!1),i.parentElement.removeChild(i);e.element.classList.remove(t.toggle_on),n.classList.remove(t.toggle_on)},u=function(e,t){var n=function(){var i=t.ownerDocument,o=i.defaultView||i.parentWindow;c(e,t),o.removeEventListener("click",n)};return n},m=function(e){e.preventDefault(),e.stopPropagation();var n=e.target;if(n.classList.contains(t.minimize_group)||n.classList.contains(t.minimize_gr_v))return void p(n);if(n.classList.contains(t.toggle))return void r(n);if(!(n.classList.contains(t.tb)||n.classList.contains(t.group)||n.classList.contains(t.vertical_group))){var i=null,d=null,m=null,g=null,f=n.ownerDocument,v=f.defaultView||f.parentWindow;if(g=a(n),i=g.tools[n.dataset.tool_id],"dropdown"===i.type){if(n.classList.contains(t.toggle_on))return void c(i,n);d=s(f,i,g);var h=i.element;n.classList.add(t.toggle_on),h.classList.add(t.toggle_on),m=o(n),"tb_item"===i.dd_items_width&&(d.style.width=n.offsetWidth+"px"),"s"===i.orientation?(d.style.top=m.top+n.offsetHeight+"px",d.style.left=m.left+"px"):"sw"===i.orientation?(d.style.top=m.top+n.offsetHeight+"px",d.style.left=m.left-d.offsetWidth+"px"):"nw"===i.orientation?(d.style.top=m.top-d.offsetHeight+n.offsetHeight+"px",d.style.left=m.left-d.offsetWidth+"px"):"se"===i.orientation?(d.style.top=m.top+n.offsetHeight+"px",d.style.left=m.left+n.offsetWidth+"px"):"ne"===i.orientation?(d.style.top=m.top-d.offsetHeight+n.offsetHeight+"px",d.style.left=m.left+n.offsetWidth+"px"):(d.style.top=m.top-d.offsetHeight+"px",d.style.left=m.left+"px"),d.classList.add(t.dd_open),e.stopPropagation&&e.stopPropagation(),v.addEventListener("click",u(i,n),!1)}else l(i,"click")}},p=function(e){var n=e.nextSibling;e.classList.contains(t.minimize_icon)?(e.classList.add(t.maximize_icon),e.classList.remove(t.minimize_icon),e.title="Maximize group",n.style.display="none"):(e.classList.add(t.minimize_icon),e.classList.remove(t.maximize_icon),e.title="Minimize group",n.style.display="")},g=function(){console.log("WUI_RangeSlider 'create' failed, first argument not an id nor a DOM element.")};this.create=function(i,o,l){var s,d,c=null,u=null,p=null,f=null,v={};if("string"==typeof i)s=document.getElementById(i);else{if("object"!=typeof i)return void g();if("string"!=typeof i.innerHTML)return void g();s=i,i=s.id}if(void 0!==e[i])return void console.log("WUI_Toolbar id '"+i+"' already created, aborting.");for(d in n)n.hasOwnProperty(d)&&(v[d]=n[d]);if(void 0!==o)for(d in o)o.hasOwnProperty(d)&&void 0!==n[d]&&(v[d]=o[d]);e[i]={element:s,tools:[],opts:v},s.classList.add(t.tb);var h=t.group,_=t.item,w="wui-toolbar-spacer",y=t.minimize_group;v.vertical?(s.classList.add("wui-toolbar-vertical"),h=t.vertical_group,_+=" wui-toolbar-item-vertical",w="wui-toolbar-spacer-vertical",y=t.minimize_gr_v,s.style.maxWidth=v.item_width+4+"px",null===v.item_hmargin&&(v.item_hmargin=3),null===v.item_vmargin&&(v.item_vmargin=8)):(s.style.maxHeight=v.item_height+4+"px",null===v.item_hmargin&&(v.item_hmargin=3),null===v.item_vmargin&&(v.item_vmargin=0)),y=t.button+" "+t.minimize_icon+" "+y,s.addEventListener("click",m,!1);var b;for(p in l)if(l.hasOwnProperty(p)){null!==f&&(u=document.createElement("div"),u.className=w,s.appendChild(u)),v.allow_groups_minimize&&(u=document.createElement("div"),u.className=y,u.title="Minimize group",s.appendChild(u)),c=l[p];var L=document.createElement("div");for(L.className=h,v.vertical?L.style.maxWidth=v.item_width+"px":L.style.maxHeight=v.item_height+"px",b=0;b<c.length;b+=1){var E,x=c[b],C=document.createElement("div"),k=e[i].tools.length,I={element:C,on_click:x.on_click,on_rclick:x.on_rclick,icon:x.icon,items:[],tooltip:"",type:x.type,dd_items_width:x.dropdown_items_width,orientation:x.orientation,id:k};if(I.on_rclick&&C.addEventListener("contextmenu",function(e){var t=a(e.target),n=t.tools[e.target.dataset.tool_id];e.preventDefault(),n.on_rclick()}),C.className=_,C.style.minWidth=v.item_width+"px",C.style.minHeight=v.item_height+"px",C.style.marginLeft=v.item_hmargin+"px",C.style.marginRight=v.item_hmargin+"px",C.style.marginTop=v.item_vmargin+"px",C.style.marginBottom=v.item_vmargin+"px",C.style.backgroundSize=v.icon_width-4+"px "+(v.icon_height-4)+"px",L.appendChild(C),e[i].tools.push(I),C.dataset.tool_id=k,I.tooltip=x.tooltip,void 0!==x.tooltip&&(C.title=x.tooltip),void 0!==x.text&&(C.innerHTML=x.text,C.style.lineHeight=v.item_height+"px",C.classList.add("wui-toolbar-text"),void 0!==x.icon&&(C.style.paddingLeft=v.icon_width+2+"px",C.style.backgroundPosition="left center")),void 0!==x.icon&&C.classList.add(x.icon),"toggle"===x.type)C.classList.add(t.toggle),I.toggled_icon=x.toggled_icon,I.tooltip_toggled=x.tooltip_toggled,I.toggled_style=x.toggled_style,void 0!==x.toggle_group&&(C.dataset.toggle_group=x.toggle_group),x.toggle_state&&(C.dataset.on="1");else if("dropdown"===x.type){if(C.classList.add(t.button),void 0!==x.items)for(E=0;E<x.items.length;E+=1){var T=x.items[E];I.items.push({title:T.title,on_click:T.on_click})}}else C.classList.add(t.button)}s.appendChild(L),f=c}var W=s.getElementsByClassName(t.item);for(b=0;b<W.length;b+=1){var D=W[b];"1"===D.dataset.on&&(D.dataset.on="0",r(D,i,!0))}return i},this.hideGroup=function(e,n){var o,a,l,s=i(e);if(s){if(o=s.element.getElementsByClassName(s.opts.vertical?t.vertical_group:t.group),0===o.length)return;a=o[n],l=a.previousElementSibling,(l.classList.contains(t.minimize_group)||l.classList.contains(t.minimize_gr_v))&&(l.style.display="none"),a.style.display="none"}},this.showGroup=function(e,n){var o,a,l,s=i(e);if(s){if(o=s.element.getElementsByClassName(s.opts.vertical?t.vertical_group:t.group),0===o.length)return;a=o[n],l=a.previousElementSibling,(l.classList.contains(t.minimize_group)||l.classList.contains(t.minimize_gr_v))&&(l.style.display=""),o[n].style.display=""}},this.toggle=function(e,t,n){var o=i(e);o&&r(o.tools[t].element,e,n)},this.getItemElement=function(e,t){var n=i(e);if(n)return n.tools[t].element},this.destroy=function(t){var n,i,o,a,l,s,r,d=e[t];if(void 0===d)return void console.log("Element id '"+t+"' is not a WUI_ToolBar, destroying aborted.");for(n=d.toolbar,i=d.tools,n.parentElement.removeChild(n),r=0;r<i.length;r+=1)o=i[r],"dropdown"===o.type&&(a=o.items,a.length>0&&(l=a[0],s=l.element,s.parentElement.removeChild(s)));delete e[t]}},WUI_CircularMenu=new function(){"use strict";var e=[],t=0,n={item:"wui-circularmenu-item",show:"wui-circularmenu-show",content:"wui-circularmenu-content"},i={x:null,y:null,rx:64,ry:48,angle:0,item_width:32,item_height:32,window:null,element:null},o=function(t){var n,i;for(i=0;i<e.length;i+=1)n=e[i],t.body.contains(n)&&t.body.removeChild(n)},a=function(e,i){var a=function(l){l.preventDefault();var s=(new Date).getTime();s-t<=500||l.target.classList.contains(n.item)||(o(i),e.removeEventListener("mousedown",a))};return a},l=function(e,t,n){var i=function(i){i.preventDefault(),n(),o(t),e.removeEventListener("mousedown",a(e,t))};return i},s=function(e){var t=e.getBoundingClientRect(),n=document.body,i=document.documentElement,o=window.pageYOffset||i.scrollTop||n.scrollTop,a=window.pageXOffset||i.scrollLeft||n.scrollLeft,l=i.clientTop||n.clientTop||0,s=i.clientLeft||n.clientLeft||0,r=t.top+o-l,d=t.left+a-s;return{top:Math.round(r),left:Math.round(d),width:t.width,height:t.height}},r=function(e){return e*(Math.PI/180)},d=function(i,s,d,c,u,m){o(c);var p,g,f,v,h,_=-(Math.PI/2)+r(i.angle),w=s.length,y=2*Math.PI/w;for(v=0;v<w;v+=1)f=s[v],p=document.createElement("div"),p.classList.add(n.item),p.style.width=i.item_width+"px",p.style.height=i.item_height+"px",p.style.backgroundSize=i.item_width-4+"px "+(i.item_height-4)+"px",p.style.left=u+i.rx*Math.cos(_)+"px",p.style.top=m+i.ry*Math.sin(_)+"px",p.classList.add(f.icon),f.tooltip&&(p.title=f.tooltip),f.content&&(g=document.createElement("div"),g.style.width=i.item_width+"px",g.style.height=i.item_height+"px",g.classList.add(n.content),g.innerHTML=f.content,p.appendChild(g)),c.body.appendChild(p),d.getComputedStyle(p).width,e.push(p),f.on_click&&p.addEventListener("click",l(d,c,f.on_click)),p.classList.add(n.show),_+=y;h=a(d,c),t=(new Date).getTime(),d.addEventListener("mousedown",h)};this.create=function(e,t){var n,o,a,l,r,c={},u=document,m=window;for(n in i)i.hasOwnProperty(n)&&(c[n]=i[n]);if(void 0!==e)for(n in e)e.hasOwnProperty(n)&&void 0!==i[n]&&(c[n]=e[n]);l=c.element,null!==l?(r=s(l),u=l.ownerDocument,m=u.defaultView||u.parentWindow,o=r.left+(r.width-c.item_width)/2,a=r.top+(r.height-c.item_height)/2,d(c,t,m,u,o,a)):null!==o&&null!==a&&(null!==c.window&&(m=c.window,u=m.document),o=c.x-c.item_width/2,a=c.y-c.item_height/2,d(c,t,m,u,o,a))}},WUI=new function(){"use strict";var e={display_none:"wui-display-none",hide_fi_500:"wui-hide-fi-500",hide_show_500:"wui-show-fi-500",draggable:"wui-draggable"},t=[],n=null,i=null,o=null,a=0,l=0,s=function(t,n,i){var o=function(){i&&t.classList.add(e.display_none),n&&n(),t.removeEventListener("transitionend",o)};return o},r=function(s){s.preventDefault();var r,u=s.clientX,m=s.clientY,p=s.changedTouches;if(s.target.classList.contains(e.draggable)){if(null===n)if(p)o=p[0].identifier,u=p[0].clientX,m=p[0].clientY;else if(0!==s.button)return;r=t[parseInt(s.target.dataset.wui_draggable_id,10)],n=void 0!==r.target_element?r.target_element:s.target,i=parseInt(n.dataset.wui_draggable_id,10),document.body.style.cursor="move",r.virtual?(r=t[i],a=u-parseInt(r.x,10),l=m-parseInt(r.y,10)):(a=u-parseInt(n.style.left,10),l=m-parseInt(n.style.top,10)),window.addEventListener("mousemove",d,!1),window.addEventListener("touchmove",d,!1),window.addEventListener("mouseup",c,!1),window.addEventListener("touchend",c,!1)}},d=function(e){e.preventDefault();var s,r=e.clientX,d=e.clientY,c=e.changedTouches,u=null,m=t[i],p=m.x,g=m.y;if(c)for(s=0;s<c.length;s+=1)if(u=c[s],u.identifier===o){r=c[s].clientX,d=c[s].clientY;break}0!==m.axisLock&&(p=r-a,m.virtual||(n.style.left=p+"px"),m.x=p),1!==m.axisLock&&(g=d-l,m.virtual||(n.style.top=g+"px"),m.y=g),m&&void 0!==m.cb&&m.cb(n,p,g)},c=function(e){e.preventDefault();var i,a=e.changedTouches,l=null;if(0!==t.length)if(a){for(i=0;i<a.length;i+=1)if(l=a[i],l.identifier===o){n=null,document.body.style.cursor="default",window.removeEventListener("touchmove",d,!1),window.removeEventListener("touchend",c,!1);break}}else n=null,document.body.style.cursor="default",window.removeEventListener("mousemove",d,!1),window.removeEventListener("mouseup",c,!1)};this.fadeOut=function(t,n,i,o){var a;void 0!==n&&null!==n||(n=500),a="visibility 0s ease-in-out "+n+"ms, opacity "+n+"ms ease-in-out",void 0===t.style.WebkitTransition?t.style.transition=a:t.style.WebkitTransition=a,t.addEventListener("transitionend",s(t,i,o),!1),t.classList.add(e.hide_fi_500),t.classList.remove(e.hide_show_500)},this.fadeIn=function(t,n){var i;void 0!==n&&null!==n||(n=500),i="visibility 0s ease-in-out 0s, opacity "+n+"ms ease-in-out",void 0===t.style.WebkitTransition?t.style.transition=i:t.style.WebkitTransition=i,t.classList.remove(e.hide_fi_500),t.classList.add(e.hide_show_500),t.classList.remove(e.display_none)},this.draggable=function(n,i,o,a){n.classList.contains(e.draggable)||(n.classList.add(e.draggable),n.addEventListener("mousedown",r,!1),n.addEventListener("touchstart",r,!1),n.dataset.wui_draggable_id=t.length,t.push({cb:i,element:n,target_element:a,axisLock:null,virtual:o,x:parseInt(n.style.left,10),y:parseInt(n.style.top,10)}))},this.undraggable=function(n){if(n.classList.contains(e.draggable)){n.classList.remove(e.draggable),n.removeEventListener("mousedown",r,!1),n.removeEventListener("touchstart",r,!1);var i,o=parseInt(n.dataset.wui_draggable_id,10);for(t.splice(o,1),i=0;i<t.length;i+=1){var a=t[i];a.element.dataset.wui_draggable_id=i}}},this.lockDraggable=function(n,i){if(n.classList.contains(e.draggable)){var o=t[parseInt(n.dataset.wui_draggable_id,10)];o.axisLock="x"===i?0:"y"===i?1:null}}},SPlayer=new function(){"use strict";window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;var e,t=0,n=[],i=0,o=null,a=[],l=null,s={width:400,height:200,octaves:10,baseFrequency:16.34,gainBarSideMargin:1,gainContainerWidth:16,gainContainerHeight:12,gainLevel:1,gainLevels:3,acceptDrop:!0,acceptDownload:!0,sps:60,gain:1.5,gainMultiplier:.5,backgroundColor:"#000000"},r={hook_class:"hplayer",loader_class:"sloader",marker_class:"smarker",past_marker_class:"smarker-past",main_class:"splayer",gain_class:"sgain",gain_bar_class:"sgain-bar",gain_unused_bar_class:"sgain-unused-bar",toolbar_class:"stoolbar",osd_class:"sosd"},d=!1,c={};window.AudioContext=window.AudioContext||window.webkitAudioContext||!1;var u,m,p=new window.AudioContext,g=new Worker("dist/worker/notes_renderer.js"),f=new Worker("dist/worker/audio_renderer.js"),v=new Worker("dist/worker/recorder.js"),h=function(e,t,n,i,o){g.postMessage({uid:e,data:t,width:n,height:i,options:o},[t.buffer])},_=function(e,t,n){var i=e.createGain();return i.gain.value=t,i.connect(n),i},w=function(e,t){e.gain.value=t},y=function(e){return _(p,e,m)},b=function(e,t){var n=p.createBufferSource();return t?n.buffer=t:n.buffer=null,n.connect(e),n},L=function(){return p.currentTime},E=function(e,t,n,i,o){return e.buffer?(e.onended=o,t.gain.cancelScheduledValues(p.currentTime),e.start(0,i),t.gain.exponentialRampToValueAtTime(n,p.currentTime+.005),p.currentTime):null},x=function(e,t){return function(){p.currentTime>t?(e.stop(),e.stopped=!0):setTimeout(x(e,t),100)}},C=function(e,t,n){var i;return void 0!==n&&(e.onended=n),e.buffer&&(i=p.currentTime+.005,t.gain.cancelScheduledValues(p.currentTime),t.gain.exponentialRampToValueAtTime(1e-5,i),setTimeout(x(e,i),100)),p.currentTime},k=function(e,t){var n,i,o=e.sampleRate,a=o*t.seconds,l=t.decay,s=e.createBuffer(2,a,o),r=s.getChannelData(0),d=s.getChannelData(1);for(i=0;i<a;i++)n=t.reverse?a-i:i,r[i]=(2*Math.random()-1)*Math.pow(1-n/a,l),d[i]=(2*Math.random()-1)*Math.pow(1-n/a,l);return s},I=function(e,t,n){var i=e.createConvolver();return i.buffer=k(e,n),i.connect(t),i},T=function(e,t){e.buffer&&(t||(t="output"),v.postMessage({command:"record",buffer:[e.buffer.getChannelData(0),e.buffer.getChannelData(1)]}),v.postMessage({command:"exportWAV",type:"audio/wav",filename:t}))},W=function(){v.postMessage({command:"init",config:{sampleRate:p.sampleRate,numChannels:2,gain:c.gain}}),v.onmessage=function(e){var t=e.data.blob,n=new File([t],e.data.filename+".wav",{type:"audio/wav"});saveAs(n),v.postMessage({command:"clear"})},u=_(p,1,p.destination),m=I(p,u,{seconds:.1,decay:1,reverse:!1}),g.addEventListener("message",function(e){var t=e.data;t.sample_rate=p.sampleRate,f.postMessage(t)},!1),f.addEventListener("message",function(e){var t,n=e.data,i=new Float32Array(n.data_l),o=new Float32Array(n.data_r);t=p.createBuffer(2,n.length,p.sampleRate),t.copyToChannel(i,0,0),t.copyToChannel(o,1,0),O(n.uid,t,Math.max(n.avg_l,n.avg_r))},!1)};window.AudioContext||D("The Web Audio API is not available, please use a Web Audio capable browser."),"undefined"==typeof Worker&&D("Web Workers are not available, please use a web browser with Web Workers support."),window.FileReader||D("The FileReader API is not available, please use a FileReader capable browser.");var D=function(e){d=!0},M=function(e,t){var n=(+e).toFixed(t+1);return+n.slice(0,n.length-1)},z=function(e){var t=e.getBoundingClientRect(),n=document.body,i=document.documentElement,o=window.pageYOffset||i.scrollTop||n.scrollTop,a=window.pageXOffset||i.scrollLeft||n.scrollLeft,l=i.clientTop||n.clientTop||0,s=i.clientLeft||n.clientLeft||0,r=t.top+o-l,d=t.left+a-s;return{top:Math.round(r),left:Math.round(d),width:t.width,height:t.height}},B=function(e){var t=0;for(t=0;t<a.length;t+=1)if(a[t].id===e)return a[t]},N=function(e,t){t?e.osd_div.innerHTML=M(t,1)+"/"+M(e.audio_buffer.duration,1)+"s":e.osd_div.innerHTML=M(e.audio_buffer.duration,1)+"s"},O=function(e,t,n){var a=B(e);a.audio_buffer=t,a.audio_buffer_source=b(a.audio_gain_node,a.audio_buffer),a.spinner_div.parentNode===a.div&&(a.div.removeChild(a.spinner_div),a.div.removeChild(a.spinner.el)),N(a),i-=1,i<0&&clearTimeout(o)},S=function(e){e.audio_buffer_source=b(e.audio_gain_node,e.audio_buffer)},A=function(e,t){var n=document.createElement("canvas"),i=n.getContext("2d");n.width=e.width,n.height=e.height,i.fillStyle="#000000",i.fillRect(0,0,n.width,n.height),i.drawImage(e,0,0),n.toBlob(t,"image/png")},P=function(e){var t=document.createElement("canvas"),n=t.getContext("2d");return t.width=e.width,t.height=e.height,n.fillStyle="#000000",n.fillRect(0,0,t.width,t.height),n.drawImage(e,0,0),n.getImageData(0,0,t.width,t.height).data},R=function(e){return function(){S(e),e.audio_buffer_source.loop=e.audio_loop,e.stopped&&F(e),e.paused=!0,e.stopped=!0,e.audio_loop||WUI_ToolBar.toggle(e.toolbar,0,!1)}},U=function(t){var n,i,o=0,l=0,r=0;for(o=0;o<a.length;o+=1)i=a[o],i.stopped||i.paused||(l=L()-i.audio_started_at,r=l/i.audio_buffer.duration,n=Math.round(s.width*r)+"px",i.marker_div.style.left=n,i.past_marker_div.style.width=n,N(i,l));e=window.requestAnimationFrame(U)},H=function(e){e.marker_div.style.display="",e.past_marker_div.style.display=""},F=function(e){""===e.marker_div.style.display&&""===e.past_marker_div.style.display&&(e.marker_div.style.display="none",e.past_marker_div.style.display="none")},V=function(e,t){var n=0,i=t;e.paused&&(void 0===i&&(i=e.audio_paused_at),n=E(e.audio_buffer_source,e.audio_gain_node,re(e),i,R(e)),null!==n&&(e.paused=!1,e.stopped=!1,e.audio_started_at=n-i,e.audio_paused_at=0,e.marker_div.style.left="0"),H(e))},X=function(e){e.paused||(e.audio_paused_at=C(e.audio_buffer_source,e.audio_gain_node)-e.audio_started_at)},Y=function(e,t,n){e.audio_paused_at=0,t||(F(e),N(e)),e.stopped||(C(e.audio_buffer_source,e.audio_gain_node,n),e.stopped=!0)},j=function(e,t){return function(){S(e),e.paused=!0,V(e,e.audio_buffer.duration*t),N(e),e.seeking=!1}},q=function(e,t){e.audio_buffer&&(e.seeking=!0,Y(e,!0,j(e,t)))},G=function(e){return function(t){if(e.div===e.spinner_div.parentNode)return void WUI_ToolBar.toggle(e.toolbar,0,!1);if(t.state){if(!e.audio_buffer)return void WUI_ToolBar.toggle(e.toolbar,0,!1);V(e)}else X(e),WUI_ToolBar.toggle(e.toolbar,0,!1)}},$=function(e){return function(){e.div!==e.spinner_div.parentNode&&e.audio_buffer&&(Y(e),e.stopped||WUI_ToolBar.toggle(e.toolbar,0,!1))}},J=function(e){return function(){T(e.audio_buffer_source,e.filename)}},K=function(e){return function(t){var n=new File([t],e.filename+".png",{type:"image/png"});saveAs(n)}},Q=function(e){return function(){A(e.image,K(e))}},Z=function(e){var t=e.canvas,n=e.canvas_ctx,i=e.options;"transparent"===i.backgroundColor?n.clearRect(0,0,t.width,t.height):(n.fillStyle=i.backgroundColor,n.fillRect(0,0,t.width,t.height))},ee=function(e){var t=e.canvas,n=e.canvas_ctx;e.options;n.globalCompositeOperation="source-over",Z(e),e.magnify?(n.globalCompositeOperation="lighter",n.drawImage(e.image,0,0,t.width,t.height),n.drawImage(e.image,0,0,t.width,t.height),n.drawImage(e.image,0,0,t.width,t.height)):(n.globalCompositeOperation="source-over",
n.drawImage(e.image,0,0,t.width,t.height))},te=function(e){return function(t){e.magnify=t.state,ee(e)}},ne=function(e){var t,n=e.div,i=(e.uid,document.createElement("div"));n.appendChild(i),i.id="t"+n.id,t=WUI_ToolBar.create(i,{allow_groups_minimize:!1,icon_width:24,icon_height:24,item_width:28,item_height:28,item_hmargin:2},{transport:[{icon:"sp-play-icon",toggled_icon:"sp-pause-icon",type:"toggle",on_click:G(e),tooltip:"play",tooltip_toggled:"pause"},{icon:"sp-stop-icon",on_click:$(e),tooltip:"stop"}],tools:[{icon:"sp-magnify-icon",on_click:te(e),tooltip:"magnify",type:"toggle"}],acts:[{icon:"sp-image-icon",on_click:Q(e),tooltip:"download as a .png file"},{icon:"sp-download-icon",on_click:J(e),tooltip:"download as a .wav file"}]}),i.classList.add(r.toolbar_class),e.toolbar=t,e.toolbar_div=i},ie=function(){var e,t=navigator.hardwareConcurrency;return t||(t=1),i>=t?(clearTimeout(o),void(o=setTimeout(ie,1e3))):(e=n.shift(),void(e&&(h(e.uid,P(e.image),e.image.naturalWidth,e.image.naturalHeight,e.options),i+=1,clearTimeout(o),o=setTimeout(ie,1e3))))},oe=function(e,t,i){var a=B(e);a.div.parentNode!==a.spinner&&(a.div.appendChild(a.spinner_div),a.div.appendChild(a.spinner.el)),n.push({uid:e,image:t,options:i}),clearTimeout(o),o=setTimeout(ie,100)},ae=function(e){var t,n=0;l&&(t=z(l.div),n=Math.max(Math.min(e.clientX-t.left,l.options.width),0),q(l,n/l.options.width))},le=function(e){return function(t){var n,i,o,a=t.target;0===t.button&&("CANVAS"===a.tagName||a.classList.contains("smarker-past"))&&(l||(n=B(e),i=z(n.div),l=n,l.div.addEventListener("mousemove",ae),WUI_ToolBar.toggle(n.toolbar,0,!0),o=t.clientX-i.left,q(l,o/l.options.width)))}},se=function(){return function(e){l&&l.div.removeEventListener("mousemove",ae),l=null}},re=function(e){return e.options.gain*(1+e.options.gainMultiplier*(e.audio_gain_level-1))},de=function(e){return function(t){var n,i=B(e);for(i.audio_gain_level+=1,i.audio_gain_level%=i.options.gainLevels+1,0===i.audio_gain_level&&(i.audio_gain_level+=1),n=0;n<i.options.gainLevels;n+=1)n>=i.audio_gain_level?i.gains_div_arr[n].classList.add(r.gain_unused_bar_class):i.gains_div_arr[n].classList.remove(r.gain_unused_bar_class);w(i.audio_gain_node,re(i))}},ce=function(e){return e.preventDefault(),!1},ue=function(e){return function(){var t=this;oe(e.id,t,e.options),e.image=t,ee(e),t.onload=null}},me=function(e,t){var n=new Image,i=document.createElement("canvas");i.getContext("2d");$(e)(),n.onload=ue(e),e.filename=t.name,n.src=window.URL.createObjectURL(t)},pe=function(e){return function(t){var n,i,o=B(e),a=t.dataTransfer;for(t.preventDefault(),i=0;i<a.files.length;i+=1)n=a.files[i],n.type.match("image.*")?me(o,n):n.type.match("audio.*")||D("Could not load the file '"+n.name+"', the filetype is unknown.");return!1}},ge=function(e,n){var i,o,l,s,d,c,u,m,p,g,f,v,h,_,w,L=[],E=e.naturalWidth/n.width,x=e.naturalHeight/n.height,C=e.naturalWidth/E,k=e.naturalHeight/x;for(u=document.createElement("div"),u.style.width=n.gainContainerWidth+"px",u.style.height=n.gainContainerHeight+"px",u.classList.add(r.gain_class),m=Math.floor(n.gainContainerWidth/n.gainLevels)-n.gainBarSideMargin*n.gainLevels,w=0;w<n.gainLevels;w+=1)p=document.createElement("div"),p.classList.add(r.gain_bar_class),p.style.width=m+"px",p.style.height=Math.round((w+1)/n.gainLevels*100,10)+"%",p.style.marginLeft=n.gainBarSideMargin+"px",p.style.marginRight=n.gainBarSideMargin+"px",w>=n.gainLevel&&p.classList.add(r.gain_unused_bar_class),u.appendChild(p),L.push(p);return u.addEventListener("click",de(t)),d=document.createElement("div"),d.classList.add(r.loader_class),c=document.createElement("div"),c.classList.add(r.marker_class),f=document.createElement("div"),f.classList.add(r.past_marker_class),g=document.createElement("div"),g.classList.add(r.osd_class),g.title="playtime/duration",s=new Spinner({lines:2,length:2,width:1,radius:2,scale:8,corners:1,color:"#fff",opacity:0,rotate:0,direction:1,speed:1.5,trail:83,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!0,position:"absolute"}).spin(),l=document.createElement("div"),l.id="sp_"+t,l.classList.add(r.main_class),l.style.width=n.width+"px",l.style.height=n.height+"px",i=document.createElement("canvas"),o=i.getContext("2d"),i.width=C,i.height=k,Z({canvas:i,canvas_ctx:o,options:n}),o.drawImage(e,0,0,i.width,i.height),l.appendChild(i),l.appendChild(u),l.appendChild(c),l.appendChild(f),l.appendChild(g),l.dataset.player=t,h=e.src.replace(/^.*[\\\/]/,"").replace(/\.[^\/.]+$/,""),v=y(n.gain*(1+n.gainMultiplier*(n.gainLevel-1))),_={id:t,div:l,canvas:i,canvas_ctx:o,image:e,options:n,paused:!0,stopped:!0,seeking:!1,audio_buffer:null,audio_buffer_source:b(v),audio_gain_node:v,audio_started_at:0,audio_paused_at:0,audio_loop:!1,audio_gain_level:n.gainLevel,gains_div_arr:L,spinner_div:d,spinner:s,filename:h,magnify:!1,toolbar:null,toolbar_div:null,marker_div:c,past_marker_div:f,osd_div:g},F(_),a.push(_),l.addEventListener("mousedown",le(t)),oe(t,e,n),n.acceptDrop&&(l.addEventListener("dragover",ce),l.addEventListener("dragenter",ce),l.addEventListener("drop",pe(t))),t+=1,_};this.apply=function(){if(!d){var e,t,n,i,o,a=Array.prototype.slice.call(document.getElementsByClassName(r.hook_class)),l={},c=0;if(a.length)for(c=0;c<a.length;c+=1)if(e=a[c],"IMG"===e.tagName){if(t=e,0===t.naturalWidth||0===t.naturalHeight)continue;for(i in t.dataset)t.dataset.hasOwnProperty(i)&&void 0!==s[i]&&(l[i]=t.dataset[i],o+=1);for(i in s)s.hasOwnProperty(i)&&void 0===l[i]&&(l[i]=s[i]);n=ge(t,l),n&&(t.parentElement.insertBefore(n.div,t),t.parentElement.removeChild(t),ne(n))}}},this.setOptions=function(e){if(e){var t;for(t in e)e.hasOwnProperty(t)&&void 0!==s[t]&&(c[t]=parseFloat(e[t]));this.apply()}};for(var fe in s)s.hasOwnProperty(fe)&&(c[fe]=s[fe]);W(),document.body.addEventListener("mouseup",se()),e=window.requestAnimationFrame(U)};window.onload=function(){SPlayer.apply()};